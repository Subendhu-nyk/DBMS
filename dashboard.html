<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <title>Document</title>
    <style>
        *{
            padding: 0px;
            margin: 0px;
        }
        .row1{            
            height: 640px;
        }

        .a1{
            text-decoration: none;
            color: white;
            font-weight: Bold;            
        }
        a:hover{
            color: #ffc107;
        }
        .add{
            text-decoration: none;
            color: black;
           
        }
        .rightbg{
            background: linear-gradient(to right, #a0aeb3, #ffffff);
        }
        .innercol{
            height: 530px;
            
            color: #5b0a69;
        }
        .innercol2{
            height: 635px;
            background: linear-gradient(to left, #a0aeb3, #ffffff);
    
           
        }

    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-primary bg-gradient">        
        <div class="container-fluid"> 
            <div class="container d-flex ">
            <a class="navbar-brand fs-1 a1" href="/html/index.html">Admin Dashboard</a>               
            <div class="collapse navbar-collapse justify-content-end" id="navbarTogglerDemo03">                
                <div class="d-flex">
                    
                     <a href="login.html"><button class="btn btn-warning mx-3" id="logoutButton">Logout</button></a>                                        
                </div>           
          </div>
        </div> 
        </div>
      </nav>
      <section>
    <div class="container-fluid">
       <div class="row row1 ">
        <div class="col-lg-2 rightbg ">
            <div class="row">
                <div class="col-12 innercol" id="tablenameui">

                </div>
                <div class="col-12 d-flex justify-content-center mb-4">
                    <div>      <!-- Button trigger modal -->
                        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#fileAttach">
                         + Upload Excell Sheet
                        </button>
                    </div>
                    <!-- Excel modal -->
                    <div class="modal fade" id="fileAttach" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Create table</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form method="post" onsubmit="uploadExcelTable(event)" enctype="multipart/form-data"> 
                            <div class="modal-body"> 
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="mb-3">
                                            <label for="filetablename" class="col-form-label"><b>Table Name</b></label>
                                            <input type="text" class="form-control" required name="filetablename" id="filetablename">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">                                       
                                    </div>
                                </div>   
                                <div class="row">
                                    <div class="col-lg-12">
                                        <label for="file" class="form-label">Upload File</label>
                                    </div>  
                                    <div class="col-lg-12">
                                        <input type="file" class="form-control" required name="file" id="file">
                                    </div>
                                </div>                                                                                   
                              </div>
                              <div class="modal-footer">                                
                                <button type="submit" class="btn btn-warning" >Create</button>
                              </div>
                            </form>
                        </div>
                        </div>
                    </div>
                    
                </div>
                <div class="col-12  d-flex justify-content-center">
                      
                    
                    <div>      <!-- Button trigger modal -->
                    <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#exampleModal">
                     + Create New Table
                    </button>
                    </div>  
                    <!-- Modal -->
                    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Create table</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form method="post" onsubmit="createTable(event)"> 
                            <div class="modal-body"> 
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="mb-3">
                                            <label for="tablename" class="col-form-label"><b>Table Name</b></label>
                                            <input type="text" class="form-control" required name="tablename" id="tablename">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">                                       
                                    </div>
                                </div>   
                                <div class="row text-center">
                                    <div class="col-lg-4">
                                        <h6>Field names</h6>
                                    </div>
                                    <div class="col-lg-4">
                                        <h6>Type</h6>
                                    </div>
                                    <div class="col-lg-2">
                                        <h6>Allow Null</h6>
                                    </div>                                   
                                    <div class="col-lg-2">
                                        <h6>Unique</h6>
                                    </div>
                                </div>  
                                <div class="row">
                                    <div class="col-lg-4" id="fieldname">
                                        <input type="text" class="form-control" required name="fieldname" id="fieldname_0">
                                    </div>
                                    <div class="col-lg-4" id="">
                                        <select class="form-select" aria-label="Default select example" id="fieldtype_0">
                                            <option selected>Select Field Type</option>
                                            <option value="INTEGER">INTEGER</option>
                                            <option value="STRING">STRING</option>
                                            <option value="DOUBLE">DOUBLE</option>
                                            <option value="BOOLEAN">BOOLEAN</option>
                                            <option value="JSON">JSON</option>
                                        </select>
                                    </div>
                                    <div class="form-check col-lg-2 d-flex justify-content-center align-items-center">
                                        <input class="form-check-input " type="checkbox" value="" id="flexCheckNull_0">                                      
                                    </div>
                                    <!-- <div class="form-check col-lg-2 d-flex justify-content-center align-items-center">
                                        <input class="form-check-input " type="checkbox" value="" id="flexCheckPrimary_0">                                      
                                    </div> -->
                                    <div class="form-check col-lg-2 d-flex justify-content-center align-items-center">
                                        <input class="form-check-input " type="checkbox" value="" id="flexCheckUnique_0">                                      
                                    </div>                                    
                                </div>
                                <div id="addfields">
                         
                                </div>  
                                
                                <div class="row">
                                    <div class="my-3">
                                        <a href="#" class="add" id="add_field" onclick="anotherfield(event)">+Add another field</a>
                                    </div> 
                                </div>                                                            
                              </div>
                              <div class="modal-footer">                                
                                <button type="submit" class="btn btn-warning" >Create</button>
                              </div>
                            </form>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-10 ">
            <div class="">
            <div class="row">
                <div class="col-10 my-4">
                    <table class="table table-striped table-hover border border-primary">
                        <thead>
                            <tr class="bg-warning" id="table-attributes">                                
                                
                            </tr>                        
                        </thead>
                        <tbody id="table-details">
                         
                      </tbody>                  
                    </table>
                </div>
                
                <div class="col-2 innercol2 py-4 d-flex justify-content-end" >
                    <div id="insertdata">

                    </div>
                </div>
            
            </div>
        </div>
        </div>

       </div>
    </div>
</section>    

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>

 
<script>
    let fieldCounter = 1;
 async function createTable(event){
    event.preventDefault();
    const tablename=document.getElementById('tablename').value  

    const fields = [];
    const fieldCount = fieldCounter;
    for (let i = 0; i < fieldCount; i++) {
        const fieldname = document.getElementById(`fieldname_${i}`).value;
        const fieldtype = document.getElementById(`fieldtype_${i}`).value;
        const allownull = document.getElementById(`flexCheckNull_${i}`).checked;
        // const primarykey = document.getElementById(`flexCheckPrimary_${i}`).checked;
        const unique = document.getElementById(`flexCheckUnique_${i}`).checked;

        fields.push({
            fieldname,
            fieldtype,
            allownull,            
            unique
        });
    }

    const tableData = {
        tablename,
        fields
    };
    console.log("this is post tabledata",tableData)
   try{
     const response= await axios.post('http://localhost:3000/',tableData)
     console.log("this is post response",response.data)
   }
   catch(err){
    console.log("Some error in post method",err)
   }    
  
}

usertableui()

function anotherfield(){
    event.preventDefault();
    const fieldContainer = document.getElementById('addfields');

    const newRow = document.createElement('div');
    newRow.className = 'row my-2 d-flex justify-content-center align-items-center ';
    const fieldnameId = `fieldname_${fieldCounter}`;
    const fieldtypeId = `fieldtype_${fieldCounter}`;
    const allowNullId = `flexCheckNull_${fieldCounter}`;
    const primaryKeyId = `flexCheckPrimary_${fieldCounter}`;
    const uniqueId = `flexCheckUnique_${fieldCounter}`;

    const fieldnameCol = document.createElement('div');
    fieldnameCol.className = 'col-lg-4';
    const fieldnameInput = document.createElement('input');
    fieldnameInput.type = 'text';
    fieldnameInput.className = 'form-control';
    fieldnameInput.required = true;
    fieldnameInput.id = fieldnameId; 
    fieldnameCol.appendChild(fieldnameInput);
    newRow.appendChild(fieldnameCol);

    const fieldtypeCol = document.createElement('div');
    fieldtypeCol.className = 'col-lg-4';
    const fieldtypeSelect = document.createElement('select');
    fieldtypeSelect.className = 'form-select'; 
    fieldtypeSelect.setAttribute('aria-label', 'Field Type');
    fieldtypeSelect.id = fieldtypeId; 

   
    const fieldTypes = ['INTEGER', 'STRING', 'DOUBLE', 'BOOLEAN', 'JSON'];
    fieldTypes.forEach(type => {
        const option = document.createElement('option');
        option.value = type;
        option.textContent = type;
        fieldtypeSelect.appendChild(option);
    });

    fieldtypeCol.appendChild(fieldtypeSelect);
    newRow.appendChild(fieldtypeCol);


    const fieldCheckNullCol = document.createElement('div');
    fieldCheckNullCol.className = 'form-check col-lg-2 d-flex justify-content-center align-items-center';
    const fieldCheckNullInput = document.createElement('input');
    fieldCheckNullInput.type = 'checkbox';
    fieldCheckNullInput.className = 'form-check-input';    
    fieldCheckNullInput.id = allowNullId; // Set the unique id
    fieldCheckNullCol.appendChild(fieldCheckNullInput);
    newRow.appendChild(fieldCheckNullCol);

    // const fieldprimaryKeyCol = document.createElement('div');
    // fieldprimaryKeyCol.className = 'form-check col-lg-2 d-flex justify-content-center align-items-center';
    // const fieldprimaryKeyInput = document.createElement('input');
    // fieldprimaryKeyInput.type = 'checkbox';
    // fieldprimaryKeyInput.className = 'form-check-input';    
    // fieldprimaryKeyInput.id =  primaryKeyId; // Set the unique id
    // fieldprimaryKeyCol.appendChild(fieldprimaryKeyInput);
    // newRow.appendChild(fieldprimaryKeyCol);


    const fieldCheckUniqueCol = document.createElement('div');
    fieldCheckUniqueCol.className = 'form-check col-lg-2 d-flex justify-content-center align-items-center';
    const fieldCheckUniqueInput = document.createElement('input');
    fieldCheckUniqueInput.type = 'checkbox';
    fieldCheckUniqueInput.className = 'form-check-input';    
    fieldCheckUniqueInput.id =  uniqueId; // Set the unique id
    fieldCheckUniqueCol.appendChild(fieldCheckUniqueInput);
    newRow.appendChild(fieldCheckUniqueCol);

    fieldContainer.appendChild(newRow);

    
    fieldCounter++;
    fetchAndDisplay()
  
}

window.addEventListener('DOMContentLoaded', () => {
    fetchAndDisplay()
    setInterval(usertableui, 1000);  
 
});

async function fetchAndDisplay(){
    try{
        const response=await axios.get('http://localhost:3000/all-tables')
        console.log(response.data.allTableNames)
        const data=response.data.allTableNames
        localStorage.setItem('tabledatalist',JSON.stringify(data))        

    }
    catch(err){
        console.log(err)
    }  
} 

let columncount=1;
function createNewColumnModal() {
    // const table=localStorage.getItem('')
    const existingModal = document.getElementById('addColumnModal');
    const currentColumncount=columncount
    if (existingModal) {
        existingModal.remove();
    }
    const table=localStorage.getItem('tablename')
    console.log("table name in column>>>>>>>",table)

    const modalDiv = document.createElement('div');
    modalDiv.className = 'modal fade';
    modalDiv.id = 'addColumnModal';
    modalDiv.setAttribute('tabindex', '-1');
    modalDiv.setAttribute('aria-labelledby', 'addColumnModalLabel');
    modalDiv.setAttribute('aria-hidden', 'true');

    const modalDialog = document.createElement('div');
    modalDialog.className = 'modal-dialog modal-dialog-centered modal-dialog-scrollable';
    modalDiv.appendChild(modalDialog);

    const modalContent = document.createElement('div');
    modalContent.className = 'modal-content';
    modalDialog.appendChild(modalContent);

    const modalHeader = document.createElement('div');
    modalHeader.className = 'modal-header';
    const headerTitle = document.createElement('h5');
    headerTitle.className = 'modal-title';
    headerTitle.id = 'addColumnModalLabel';
    headerTitle.textContent = 'Add New Column';
    modalHeader.appendChild(headerTitle);
    modalContent.appendChild(modalHeader);

    const modalBody = document.createElement('div');
    modalBody.className = 'modal-body';
    const form = document.createElement('form');
    form.id = 'addColumnForm';

    // Add fields for column name, type, allowNull, and unique
    // Similar to how you did it in createModal

    // Column Name
    const columnNameDiv = document.createElement('div');
    columnNameDiv.className = 'mb-3';
    const columnNameLabel = document.createElement('label');
    columnNameLabel.textContent = 'Column Name';
    const columnNameInput = document.createElement('input');
    columnNameInput.type = 'text';
    columnNameInput.className = 'form-control';
    columnNameInput.name = 'columnName';
    columnNameInput.id=`columnNameInput_${columncount}`
    columnNameDiv.appendChild(columnNameLabel);
    columnNameDiv.appendChild(columnNameInput);
    form.appendChild(columnNameDiv);

    // Column Type
    const columnTypeDiv = document.createElement('div');
    columnTypeDiv.className = 'mb-3';
    const columnTypeLabel = document.createElement('label');
    columnTypeLabel.textContent = 'Column Type';
    const columnTypeSelect = document.createElement('select');
    columnTypeSelect.className = 'form-select';
    columnTypeSelect.name = 'columnType';
    columnTypeSelect.id=`columnTypeSelect_${columncount}`
    const fieldTypes = ['INTEGER', 'STRING', 'DOUBLE', 'BOOLEAN', 'JSON'];
    fieldTypes.forEach(type => {
        const option = document.createElement('option');
        option.value = type;
        option.textContent = type;
        columnTypeSelect.appendChild(option);
    });
    columnTypeDiv.appendChild(columnTypeLabel);
    columnTypeDiv.appendChild(columnTypeSelect);
    form.appendChild(columnTypeDiv);

    // Allow Null
    const allowNullDiv = document.createElement('div');
    allowNullDiv.className = 'form-check';
    const allowNullInput = document.createElement('input');
    allowNullInput.type = 'checkbox';
    allowNullInput.className = 'form-check-input';
    allowNullInput.name = 'allowNull';
    allowNullInput.id=`allowNullInput_${columncount}`
    const allowNullLabel = document.createElement('label');
    allowNullLabel.className = 'form-check-label';
    allowNullLabel.textContent = 'Allow Null';
    allowNullDiv.appendChild(allowNullInput);
    allowNullDiv.appendChild(allowNullLabel);
    form.appendChild(allowNullDiv);

    // Unique
    const uniqueDiv = document.createElement('div');
    uniqueDiv.classList = 'form-check my-2 ';
    const uniqueInput = document.createElement('input');
    uniqueInput.type = 'checkbox';
    uniqueInput.className = 'form-check-input';
    uniqueInput.name = 'unique';
    uniqueInput.id=`uniqueid_${columncount}`
    const uniqueLabel = document.createElement('label');
    uniqueLabel.className = 'form-check-label';
    uniqueLabel.textContent = 'Unique';
    uniqueDiv.appendChild(uniqueInput);
    uniqueDiv.appendChild(uniqueLabel);
    form.appendChild(uniqueDiv);

    const addButton = document.createElement('button');
    addButton.type = 'submit';
    addButton.className = 'btn btn-primary';
    addButton.textContent = 'Add Column';
    form.appendChild(addButton);
    console.log("column count>>>",columncount)
    form.onsubmit = async function(event) {
        event.preventDefault();
        
         // Retrieve the values of the input elements
    const columnNameInput = document.getElementById(`columnNameInput_${currentColumncount}`);
    const columnTypeSelect = document.getElementById(`columnTypeSelect_${currentColumncount}`);
    const allowNullInput = document.getElementById(`allowNullInput_${currentColumncount}`);
    const uniqueInput = document.getElementById(`uniqueid_${currentColumncount}`);

    // Get the values from the input elements
    const columnName = columnNameInput.value;
    const columnType = columnTypeSelect.value;
    const allowNull = allowNullInput.checked; // Use checked property for checkboxes
    const unique = uniqueInput.checked; 


        const obj={
            columnName,
            columnType,
            allowNull,
            unique
        }
        console.log(obj)
        try{
            const data= await axios.post(`http://localhost:3000/create-column/${table}`,obj)
            console.log(data)

        }
        catch(err){
            console.log("error in column creation",err)
        }

    };

    modalBody.appendChild(form);
    modalContent.appendChild(modalBody);

    document.body.appendChild(modalDiv);
    columncount++;
    const modal = new bootstrap.Modal(document.getElementById('addColumnModal'));
    modal.show();

}







async function usertableui(){
    try{
         const data=JSON.parse(localStorage.getItem('tabledatalist'));
         const parenttablename=document.getElementById('tablenameui')
         parenttablename.innerHTML = '';
         data.forEach(table=>{
            
            const columnWrapper = document.createElement('div');
            columnWrapper.classList = 'd-flex justify-content-between align-items-center';

            const childtablename = document.createElement('h5');
            childtablename.classList = 'my-2 ms-2 py-2';
            childtablename.style.borderBottom = '2px solid gray';
            childtablename.style.cursor = 'pointer';
            childtablename.textContent = table;

            const tabledeletebutton = document.createElement('button');
            tabledeletebutton.type = 'button';
            tabledeletebutton.classList = 'btn-close btn-danger';            
            tabledeletebutton.setAttribute('data-bs-dismiss', 'modal');
            tabledeletebutton.setAttribute('aria-label', 'Close');

            columnWrapper.appendChild(childtablename);
            columnWrapper.appendChild(tabledeletebutton);

            parenttablename.appendChild(columnWrapper);

            tabledeletebutton.onclick=async()=>{
                const confirmation = window.confirm('Are you sure you want to delete the table?');
                        if(confirmation){
                        try{
                            
                            const data= await axios.delete(`http://localhost:3000/delete-table/${table}`)
                            console.log(data)
                        }
                        catch(err){
                            console.log("Entire row deletion error",err)  
                        }              

                    }


            }
            

            const tableHeadParent = document.getElementById('table-attributes');
            const insertDataButton=document.getElementById('insertdata')
            childtablename.onclick=async ()=>{
                try{
                    showtabledata(table)
                const response = await axios.get(`http://localhost:3000/table-attributes/${table}`)
                const  tableattributes=response.data.attributeNames
                    console.log("Attributes:",tableattributes);
                    console.log("tables:",table);
                    console.log(tableattributes[0])
                    tableHeadParent.innerHTML = '';
                    tableattributes.forEach(data=>{
                        const tableHeadChild=document.createElement('th')
                        tableHeadChild.style.fontSize='18px'
                        tableHeadChild.classList='text-center'
                        tableHeadChild.style.textTransform='capitalize'
                        tableHeadChild.textContent=data
                        tableHeadParent.appendChild(tableHeadChild)
                    })
                    const actionth=document.createElement('th')
                    actionth.textContent='Action'
                    actionth.style.fontSize='18px'
                    tableHeadParent.appendChild(actionth)

                    insertDataButton.innerHTML = '';
                    const insertDataButtonchild=document.createElement('button')
                    insertDataButtonchild.type='button'
                    insertDataButtonchild.classList='btn btn-outline-success'
                    insertDataButtonchild.textContent='+ Insert Record'
                    insertDataButtonchild.style.margin='8px 0px'    
                    insertDataButtonchild.style.marginLeft="15px",
                    insertDataButtonchild.style.padding = '5px'
                    localStorage.setItem('tablename',table)
                    insertDataButtonchild.onclick=()=>{                       
                        const filteredAttributes = [];
                        for (let i = 0; i < tableattributes.length; i++) {
                            if (tableattributes[i] !== 'id' && tableattributes[i] !== 'createdAt' && tableattributes[i] !== 'updatedAt') {
                                filteredAttributes.push(tableattributes[i]);
                            }
                        }
                        createModal(filteredAttributes,table); 
                                             

                    }

                    const deleteentiretableButtonchild=document.createElement('button')
                    deleteentiretableButtonchild.type='button'
                    deleteentiretableButtonchild.classList='btn btn-outline-danger'
                    deleteentiretableButtonchild.textContent='Erase All Data '
                    deleteentiretableButtonchild.style.margin='8px 0px'    
                    deleteentiretableButtonchild.style.marginLeft="15px",
                    deleteentiretableButtonchild.style.padding = '5px'
                    console.log("this is table>>>>>",table)
                    deleteentiretableButtonchild.onclick= async()=>{
                        const confirmation = window.confirm('Are you sure you want to delete all data from this table?');
                        if(confirmation){
                        try{
                            
                            const data= await axios.delete(`http://localhost:3000/delete-table-row/${table}`)
                            console.log(data)
                        }
                        catch(err){
                            console.log("Entire row deletion error",err)  
                        }              

                    }
                    }

                    const coloumnButtonchild=document.createElement('button')
                    coloumnButtonchild.type='button'
                    coloumnButtonchild.id='addNewColumnButton'
                    coloumnButtonchild.classList='btn btn-outline-primary'
                    coloumnButtonchild.textContent='ADD New Column '
                    coloumnButtonchild.style.margin='8px 0px'    
                    coloumnButtonchild.style.marginLeft="15px",
                    coloumnButtonchild.style.padding = '5px'
                    console.log("this is table>>>>>",table)
                    coloumnButtonchild.onclick = createNewColumnModal;

                    insertDataButton.appendChild(insertDataButtonchild)
                    insertDataButton.appendChild(deleteentiretableButtonchild)
                    insertDataButton.appendChild(coloumnButtonchild)
                }
                catch(err){
                    console.error("Error in fetching attributes from table:", err);
                }
            }

        })
        
    }
    catch(err){
        console.log(err)
    }
}

async function showtabledata(tablename) {
    try {
        const response = await axios.get(`http://localhost:3000/get-data/${tablename}`);
        const data = response.data.allTableRecords;
        const tableBody = document.getElementById('table-details');
        tableBody.innerHTML = ''; // Clear existing rows

        for (let i = 0; i < data.length; i++) {
            const row = document.createElement('tr');
            const record = data[i];
            const keys = Object.keys(record);

            for (let j = 0; j < keys.length; j++) {
                const key = keys[j];
                const value = record[key];
                const cell = document.createElement('td');
                cell.textContent = value;
                row.appendChild(cell);
            }

            // Add delete button (or any other controls you need)
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.className = 'btn btn-danger';
            deleteButton.onclick = async () => {
                try {
                    await axios.delete(`http://localhost:3000/delete-data/${tablename}/${record.id}`);
                    tableBody.removeChild(row);
                } catch (error) {
                    console.error('Error deleting record:', error);
                }
            };
            const deleteCell = document.createElement('td');
            deleteCell.appendChild(deleteButton);
            row.appendChild(deleteCell);

            tableBody.appendChild(row);
        }
    } catch (err) {
        console.error("Error in fetching table data:", err);
    }
}

function createModal(attributes,tableName) {
    const existingModal = document.getElementById('dynamicModal');
    if (existingModal) {
        existingModal.remove();
    }

    if (!attributes || !Array.isArray(attributes)) {
        console.error("Invalid attributes");
        return;
    }

    const modalDiv = document.createElement('div');
    modalDiv.className = 'modal fade';
    modalDiv.id = 'dynamicModal';
    modalDiv.setAttribute('tabindex', '-1');
    modalDiv.setAttribute('aria-labelledby', 'dynamicModalLabel');
    modalDiv.setAttribute('aria-hidden', 'true');

    const modalDialog = document.createElement('div');
    modalDialog.className = 'modal-dialog modal-dialog-centered modal-dialog-scrollable';
    modalDiv.appendChild(modalDialog);

    const modalContent = document.createElement('div');
    modalContent.className = 'modal-content';
    modalDialog.appendChild(modalContent);

    const modalHeader = document.createElement('div');
    modalHeader.className = 'modal-header';
    const headerTitle = document.createElement('h5');
    headerTitle.className = 'modal-title';
    headerTitle.id = 'dynamicModalLabel';
    headerTitle.textContent = 'Insert Data';
    modalHeader.appendChild(headerTitle);
    modalContent.appendChild(modalHeader);

    const modalBody = document.createElement('div');
    modalBody.innerHTML = '';
    modalBody.className = 'modal-body';
    const form = document.createElement('form');
    form.id = 'dynamicForm';
    form.method = 'post';
    attributes.forEach(attr => {
        const inputDiv = document.createElement('div');
        inputDiv.className = 'mb-3';
        const label = document.createElement('label');
        label.textContent = attr;
        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'form-control';
        input.name = attr;
        input.id = attr;
        inputDiv.appendChild(label);
        inputDiv.appendChild(input);
        form.appendChild(inputDiv);
    });

    const insertButton = document.createElement('button');
    insertButton.type = 'submit';
    insertButton.className = 'btn btn-warning';
    insertButton.textContent = 'Insert';
    form.appendChild(insertButton);  // Append the button to the form

    form.onsubmit = async function(event) {
        event.preventDefault();
        const formDataObject = {};

        const inputFields = form.querySelectorAll('input');
        inputFields.forEach(input => {
            formDataObject[input.name] = input.value;
        });

        console.log(formDataObject);
        const tablename=localStorage.getItem('tablename')
        try {
            const response = await axios.post(`http://localhost:3000/insert-data/${tablename}`, {
                formData: formDataObject,                
            });
            console.log('Data sent successfully:', response.data.allInsertedData);
        } catch (error) {
            console.error('Error sending data:', error);
        }
        



    };

    modalBody.appendChild(form);
    modalContent.appendChild(modalBody);

    document.body.appendChild(modalDiv);

    const modal = new bootstrap.Modal(document.getElementById('dynamicModal'));
    modal.show();
}
async function uploadExcelTable(event){
            event.preventDefault()
            console.log("hii")
            const file = document.getElementById('file').files[0];
            const filetablename=document.getElementById('filetablename').value
            const obj={
                filetablename
            }
          
            const formData = new FormData();
            formData.append('file', file);
            formData.append('filetablename', filetablename)
            console.log(formData)
        try{
            const response= await axios.post('http://localhost:3000/filesent',formData,{headers: {
                        'Content-Type': 'multipart/form-data'
                    }                   
                })
            console.log(response.data.file)
        } catch (error) {
                console.error('Error uploading file:', error);
        } 
        }












</script>
</body>
</html>